document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM fully loaded and parsed');

    firebase.auth().onAuthStateChanged(user => {
        if (user) {
            console.log('User authenticated:', user.uid);
        } else {
            console.error('No user is signed in.');
        }
    });

    const uidInput = document.getElementById('uidInput');
    const mirrorButton = document.getElementById('mirrorButton');

    if (mirrorButton && uidInput) {
        mirrorButton.addEventListener('click', () => {
            const inputUid = uidInput.value.trim();
            if (inputUid) {
                console.log('Mirroring data for UID:', inputUid);
                mirrorUserData(inputUid);
            } else {
                console.warn('Please enter a valid UID.');
                alert('Please enter a valid UID.');
            }
        });
    } else {
        console.error('Mirror button or UID input not found in the DOM.');
    }
});

function mirrorUserData(sourceUid) {
    const user = firebase.auth().currentUser;
    if (!user) {
        console.error('No user is currently signed in.');
        return;
    }
    
    const targetUid = user.uid;
    const database = firebase.database();

    database.ref('sales/' + sourceUid).once('value').then(snapshot => {
        const salesData = snapshot.val();
        if (salesData) {
            database.ref('sales/' + targetUid).set(salesData);
            console.log('Sales data mirrored successfully.');
        }
    }).catch(error => {
        console.error('Error fetching sales data:', error);
    });

    database.ref('salesCounts/' + sourceUid).once('value').then(snapshot => {
        const salesCounts = snapshot.val();
        if (salesCounts) {
            database.ref('salesCounts/' + targetUid).set(salesCounts);
            console.log('Sales counts data mirrored successfully.');
        }
    }).catch(error => {
        console.error('Error fetching sales counts data:', error);
    });

    database.ref('salesOutcomes/' + sourceUid).once('value').then(snapshot => {
        const salesOutcomes = snapshot.val();
        if (salesOutcomes) {
            database.ref('salesOutcomes/' + targetUid).set(salesOutcomes);
            console.log('Sales outcomes data mirrored successfully.');
        }
    }).catch(error => {
        console.error('Error fetching sales outcomes data:', error);
    });

    database.ref('salesTimeFrames/' + sourceUid).once('value').then(snapshot => {
        const salesTimeFrames = snapshot.val();
        if (salesTimeFrames) {
            database.ref('salesTimeFrames/' + targetUid).set(salesTimeFrames);
            console.log('Sales time frames data mirrored successfully.');
        }
    }).catch(error => {
        console.error('Error fetching sales time frames data:', error);
    });
}